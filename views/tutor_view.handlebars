<style media="screen">
  .form-group {
       padding: 20px;
  }

  .input-group {
       margin: 0 auto;
       width: 250px;
       align-content: center;

  }

  #calendar {
      max-width: 900px;
      margin: 0 auto;
      margin-top: 20pt;
      /* width: 1200pt;
      margin: auto;
       */
  }

</style>
{{#if login}}
<script type="text/javascript">
  $(function() {

    // User id data
    var data = {
      user_id : {{login}}
    }

    $.ajax({
      type: 'post',
      url:'load_appointments',
      data: data,
      success: function(data) {
        if (data.success) {
          var evtCount = data.success.length;
          var events = [];
          for (var i = 0; i < evtCount; i++) {
            events.push({
              appointment_id: data.success[i].appointment_id,
              title: data.success[i].first_name + " " + data.success[i].last_name,
              start: data.success[i].date.slice(0,11) + data.success[i].start_time,
              end: data.success[i].date.slice(0,11) + data.success[i].end_time,
              description: data.success[i].course_code
            });
          }
          loadCal(events);
        }else{
          console.log("no data returned");
        }
      },
      error: function() {
        console.log("Error");
      }
    });

    function loadCal(evtArr) {
      console.log(evtArr);
      $('#calendar').fullCalendar({
        header: {
          left: 'prev,next today',
          center: 'title',
          right: 'month,agendaWeek,agendaDay'
        },
        allDaySlot: false,
        editable: false,
        selectable: false,
        selectHelper: false,
        weekends: false,
        height: 800,
        minTime: "07:00:00",
        maxTime: "21:00:00",
        slotDuration: '00:15:00',
        defaultView: "agendaWeek",
        eventColor: 'green',
        events: evtArr,
        eventTextColor: 'black',
        eventAfterRender: function(event, elt, view ) {
          var formattedTime = moment(event.start, event.end, 'HH:mm').format('HH:mm');
          if(elt.find(".fc-event-title").length === 0) {
            elt.find(".fc-event-time").text(formattedTime + " - " + event.title);
          }else {
            elt.find(".fc-event-time").text(formattedTime);
          }
          elt.find('.fc-title').after("<span>"+ event.description +"</span>");
        },
        eventClick: function(event) {
          var data = {
          'id': event.appointment_id
          };
          var querystring = encodeQueryData(data);
          location.assign("view_appointment?" + querystring);
        }
      });
    }


    function encodeQueryData(data) {
      var ret = [];
      for (let d in data)
      ret.push(encodeURIComponent(d) + '=' + encodeURIComponent(data[d]));
      return ret.join('&');
    }


  });


</script>
<div id="calendar"></div>

{{else}}
<h1 align="center">You need to login to view this page.</h1>
{{/if}}
